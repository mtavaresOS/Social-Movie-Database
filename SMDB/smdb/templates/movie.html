{% extends "base.html" %}

{% load model_helpers %}

{% block content %}
	<h2>
		{{ movie.title }} <span>({{ movie.releaseDate }})</span>
		
		{% if request.user.is_authenticated %}
			{% if request.user|hasSeen:movie %}
				<span class="button seen">You've seen this Movie!</span>
			{% else %}
				<a href="mark-seen/"><span class="button unseen">Mark as Seen</span></a>
			{% endif %}
		{% endif %}
	</h2>
	
	<img class="description-photo" src="{{ MEDIA_URL }}/images/movie-default.png" style="width: 80px"/>
	
	<div class="description">
		
		<p>
			<b class="label">Synopsis:</b><br />
			<div class="text-box">{{ movie.synopsis }}</div>
		</p>
		
		<p><b class="label">Director:</b> {% for obj in movie.directedBy %}<a href="{{ obj.get_absolute_url }}">{{ obj.name }}</a>{% if not forloop.last %}, {% endif %}{% endfor %}</p>
		<p><b class="label">Writers:</b> {% for obj in movie.writtenBy %}<a href="{{ obj.get_absolute_url }}">{{ obj.name }}</a>{% if not forloop.last %}, {% endif %}{% endfor %}</p>
		
		<p><b class="label">Genres:</b> {% for obj in movie.isOfGenre %}<a href="{{ obj.get_absolute_url }}">{{ obj }}</a>{% if not forloop.last %}, {% endif %}{% empty %}&nbsp;{% endfor %}</p>
		{% if movie.hasRating %}<p><b class="label">MPAA Rating:</b> <a href="{{ movie.hasRating.get_absolute_url }}">{{ movie.hasRating }}</a></p>{% endif %}
		{% if movie.duration %}<p><b class="label">Duration:</b> {{ movie.duration }} min</p>{% endif %}
		<p><b class="label">Release Year:</b> {{ movie.releaseDate }}</p>
		
		{% if movie.shotIn %}<p><b class="label">Shot In:</b> {% for obj in movie.shotIn %}<a href="{{ obj.get_absolute_url }}">{{ obj }}</a>{% if not forloop.last %}, {% endif %}{% empty %}&nbsp;{% endfor %}</p>{% endif %}
		
	</div>
	
	<div class="section">
		<h3 class="context-header"><span>Featured</span></h3>
		
		<table class="movie-list">
			
			{% for actor, character in movie.get_actor_character %}
				
				<tr>
					<td><a href="{{ actor.get_absolute_url }}">{{ actor.name }}</a></td>
					<td><a href="{{ character.get_absolute_url }}" class="not-bold">{{ character.name }}</a></td>
				</tr>
				
			{% empty %}
				<p>No Actors found.</p>
			{% endfor %}
			
		</table>
	</div>
	
	{% if request.user.is_authenticated %}
	<div class="section">
		<h3 class="context-header"><span>Friends who watched this Movie</span></h3>
		
		<table class="user-list">
			
			{% for user in movie|friends_who_watched:request %}
				{% include 'widgets/user-list.html' %}
			{% empty %}
				<p>None of your friends has seen this movie.</p>
			{% endfor %}
			
		</table>
	</div>
	{% endif %}
	
	<div class="section">
		<h3 class="context-header"><span>Reviews - <a href="#" style="font-size: 16px; font-weight: normal">Write a Review</a></span></h3>
		
		<table class="review-list">
		
		{% for review in movie.hasReview %}
		
			{% include 'widgets/review-list.html' %}
		
		{% empty %}
			<p>No reviews. <a href="#">Write one?</a></p>
		{% endfor %}
		
		</table>
		
	</div>
	
	<div class="section">
		<h3 class="context-header"><span>Related Movies</span></h3>
	
		<table class="movie-gallery">
			<tr>
				{% for uri, title, score in suggestions %}
					<td><a href="{{ uri }}"><img src="{{MEDIA_URL}}/images/movie-default.png" /></a></td>
				{% endfor %}
			</tr>
		
			<tr>
				{% for uri, title, score in suggestions %}
					<td><a href="{{ uri }}" alt="Score: {{score}}" title="Score: {{score}}">{{ title }}</a></td>
				{% endfor %}
			</tr>
		
		</table>
	</div>
	
{% endblock %}